{% extends "base.html" %}
{% block title %}{{ post.title }} - r/{{ post.community }}{% endblock %}
{% block head %}
	{% call super() %}
	<meta name="author" content="u/{{ post.author }}">
{% endblock %}

{% macro comment(item) -%}

<div class="comment">
	<div class="comment_left">
		<h3 class="comment_score">{{ item.score }}</h3>
		<div class="line"></div>
	</div>
	<details class="comment_right" open>
		<summary class="comment_data">
			<a class="comment_author" href="/u/{{ item.author }}">u/{{ item.author }}</a>
			{% if item.flair.0 != "" %}
				<small class="author_flair">{{ item.flair.0 }}</small>
			{% endif %}
			&bull; <span class="datetime">{{ item.time }}</span>
		</summary>
		<h4 class="comment_body">{{ item.body }}</h4>

{%- endmacro %}

{% block content %}
	<div class="post highlighted">
		<div class="post_left">
			<h3 class="post_score">{{ post.score }}</h3>
		</div>
		<div class="post_right">
			<h4>
				<b><a class="post_subreddit" href="/r/{{ post.community }}">r/{{ post.community }}</a></b>
				&bull;
				<a class="post_author" href="/u/{{ post.author }}">u/{{ post.author }}</a>
				{% if post.author_flair.0 != "" %}
					<small class="author_flair">{{ post.author_flair.0 }}</small>
				{% endif %}
				<span class="datetime">{{ post.time }}</span>
			</h4>
			<a href="{{ post.url }}" class="post_title">
				{{ post.title }}
				{% if post.flair.0 != "" %}
					<small class="post_flair" style="color:{{ post.flair.2 }}; background:{{ post.flair.1 }}">{{ post.flair.0 }}</small>
				{% endif %}
			</a>
			{% if post.post_type == "image" %}
			<img class="post_media" src="{{ post.media }}"/>
			{% else if post.post_type == "video" %}
			<video class="post_media" src="{{ post.media }}" controls autoplay loop>
			{% else if post.post_type == "link" %}
			<a id="post_url" href="{{ post.media }}">{{ post.media }}</a>
			{% endif %}
			<h4 class="post_body">{{ post.body }}</h4>
		</div>
	</div>
	<div id="sort">
		<div id="sort_confidence"><a href="?sort=confidence">Best</a></div>
		<div id="sort_top"><a href="?sort=top">Top</a></div>
		<div id="sort_new"><a href="?sort=new">New</a></div>
		<div id="sort_controversial"><a href="?sort=controversial">Controversial</a></div>
		<div id="sort_old"><a href="?sort=old">Old</a></div>
	</div>

	{% for c in comments -%}
		<div class="thread">
			{% call comment(c) %}
			<div class="replies">
				{% for reply in c.replies %}
					{% call comment(reply) %}
					<div class="replies">
						{% for response in reply.replies %}
							{% call comment(response) %}</details></div>
						{% endfor %}
					</div></details></div>
				{% endfor %}
			</div></details></div>
		</div>
	{%- endfor %}

{% endblock %}